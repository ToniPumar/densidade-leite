<!DOCTYPE html>
<html lang="gl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>C√°lculo litros desde kilos (densidade leite)</title>

  <!-- decimal.js para precisi√≥n -->
  <script src="https://cdn.jsdelivr.net/npm/decimal.js@10.4.3/decimal.min.js"></script>

  <style>
    :root{
      --bg: #f7f9fc;
      --card: #ffffff;
      --accent: #6aa6ff;
      --accent-2:#9ed0ff;
      --text: #1f2937;
      --muted:#6b7280;
      --ok:#10b981;
      --bad:#ef4444;
      --ring: rgba(106,166,255,0.35);
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Helvetica Neue',Arial}
    .wrap{min-height:100dvh;display:flex;align-items:center;justify-content:center;padding:18px}
    .card{width:100%;max-width:520px;background:var(--card);border-radius:16px;padding:20px 18px; box-shadow:0 10px 30px rgba(0,0,0,.06), 0 2px 6px rgba(0,0,0,.04);border:1px solid rgba(0,0,0,.04)}
    h1{font-size:1.2rem;margin:0 0 12px 0}
    p.sub{margin:0 0 16px 0;color:var(--muted);font-size:.95rem}
    .grid{display:grid;gap:12px;grid-template-columns:1fr 1fr;}
    .grid .full{grid-column:1/-1}
    label{display:block;font-size:.9rem;margin:0 0 6px 2px;color:#334155}
    .field{position:relative}
    input{width:100%;padding:12px 14px;border-radius:12px;border:1.5px solid #e5e7eb;background:#fafcff;font-size:1rem;outline:none;transition:border .15s, box-shadow .15s, background .15s}
    input:focus{border-color:var(--accent); box-shadow:0 0 0 4px var(--ring); background:#fff}
    input.is-bad{border-color:var(--bad)}
    .hint{font-size:.8rem;color:var(--muted);margin-top:6px}
    .error{font-size:.8rem;color:var(--bad);margin-top:6px;display:none}
    .error.show{display:block}
    .result{margin-top:16px;padding:14px;border-radius:12px;background:linear-gradient(180deg, var(--accent-2), #e9f4ff);border:1px solid rgba(106,166,255,.35)}
    .result h2{margin:0 0 6px 0;font-size:1.05rem}
    .kv{display:flex;justify-content:space-between;gap:10px;padding:8px 0;border-top:1px dashed rgba(0,0,0,.08)}
    .kv:first-of-type{border-top:none}
    .kv b{font-variant-numeric:tabular-nums}
    .ok{color:var(--ok)}
    .muted{color:var(--muted)}
    .footer{margin-top:14px;font-size:.8rem;color:var(--muted);text-align:center}
    @media (max-width: 430px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="form" aria-labelledby="ttl">
      <h1 id="ttl">Conversi√≥n de kilos a litros por densidade</h1>
      <p class="sub">Introduce graxa, prote√≠na, temperatura e kilos. Validaci√≥n estrita e c√°lculo en tempo real.</p>

      <div class="grid">
        <div class="field">
          <label for="grasa">Graxa (%)</label>
          <input id="grasa" inputmode="decimal" autocomplete="off" placeholder="ex. 4,50"
                 aria-describedby="e-grasa h-grasa" />
          <div id="e-grasa" class="error"></div>
          <div id="h-grasa" class="hint">Formato: N ou N,xx ‚Ä¢ 0‚Äì10,00 ‚Ä¢ sen letras</div>
        </div>

        <div class="field">
          <label for="proteina">Prote√≠na (%)</label>
          <input id="proteina" inputmode="decimal" autocomplete="off" placeholder="ex. 3.60"
                 aria-describedby="e-proteina h-proteina" />
          <div id="e-proteina" class="error"></div>
          <div id="h-proteina" class="hint">Formato: N ou N,xx ‚Ä¢ 0‚Äì10,00 ‚Ä¢ sen letras</div>
        </div>

        <div class="field">
          <label for="temp">Temperatura (¬∞C)</label>
          <input id="temp" inputmode="decimal" autocomplete="off" placeholder="ex. 4,0"
                 aria-describedby="e-temp h-temp" />
          <div id="e-temp" class="error"></div>
          <div id="h-temp" class="hint">0‚Äì50,0 ‚Ä¢ m√°ximo 1 decimal ‚Ä¢ sen negativos</div>
        </div>

        <div class="field">
          <label for="kilos">Kilos de leite (kg)</label>
          <input id="kilos" inputmode="numeric" autocomplete="off" placeholder="ex. 5074"
                 aria-describedby="e-kilos h-kilos" />
          <div id="e-kilos" class="error"></div>
          <div id="h-kilos" class="hint">Enteiro 0‚Äì100000 ‚Ä¢ sen decimais nin signos</div>
        </div>

        <div class="result full">
          <h2>Resultado</h2>
          <div class="kv"><span>üß™ Densidade estimada (g/ml):</span><b id="out-densidade" class="muted">‚Äî</b></div>
          <div class="kv"><span>ü•õ Litros estimados (L):</span><b id="out-litros" class="muted">‚Äî</b></div>
          <div class="kv"><span>Estado:</span><b id="out-estado" class="muted">Introduce valores v√°lidos‚Ä¶</b></div>
        </div>
      </div>

      <div class="footer">
  <strong>Modelo de densidade.</strong>
  Base: <b>1,032 g/ml</b> a <b>20&nbsp;¬∞C</b> (G=3,5&nbsp;%, P=3,3&nbsp;%).
  Axustes: por cada +1&nbsp;¬∞C ‚Üí ‚àí0,0002 g/ml; por cada ‚àí1&nbsp;¬∞C ‚Üí +0,0002 g/ml.
  Por cada +1&nbsp;% de graxa ‚Üí ‚àí0,0046 g/ml; ‚àí1&nbsp;% ‚Üí +0,0046 g/ml.
  Por cada +1&nbsp;% de prote√≠na ‚Üí +0,0010 g/ml; ‚àí1&nbsp;% ‚Üí ‚àí0,0010 g/ml.
  <br>
  F√≥rmula: <code>œÅ = 1,032 + (G‚àí3,5)¬∑(‚àí0,0046) + (P‚àí3,3)¬∑(0,0010) + (T‚àí20)¬∑(‚àí0,0002)</code>
  (onde G e P van en %, e T en ¬∞C).
</div>
    </div>
  </div>

  <script>
    const rxGraxaProt = /^(?:\d(?:[.,]\d{1,2})?|10(?:[.,]0{1,2})?)$/;
    const rxTemp      = /^(?:\d|[1-4]\d|50)(?:[.,]\d)?$/;
    const rxKilos     = /^(?:\d{1,5}|100000)$/;

    function normaliza(v){ return v.replace(',', '.'); }

    function filterDecimal2(e){
      let v = e.target.value.replace(',', '.').replace(/[^\d.]/g,'');
      const parts = v.split('.');
      let out = parts[0].replace(/^0+(?=\d)/,'');
      if(parts.length > 1){
        out += '.' + parts.slice(1).join('').slice(0,2);
      }
      if(out === '.') out='';
      e.target.value = out;
    }
    function filterDecimal1(e){
      let v = e.target.value.replace(',', '.').replace(/[^\d.]/g,'');
      const parts = v.split('.');
      let out = parts[0].replace(/^0+(?=\d)/,'');
      if(parts.length > 1){
        out += '.' + parts.slice(1).join('').slice(0,1);
      }
      if(out === '.') out='';
      e.target.value = out;
    }
    function filterInteger(e){
      e.target.value = e.target.value.replace(/[^\d]/g,'').replace(/^0+(?=\d)/,'');
    }

    function calcularDensidade(graxa, proteina, temp){
      const base = new Decimal(1.032);
      const dGraxa = new Decimal(graxa).minus(3.5).times(-0.0046);
      const dProt  = new Decimal(proteina).minus(3.3).times(0.0010);
      const dTemp  = new Decimal(temp).minus(20).times(-0.0002);
      return base.plus(dGraxa).plus(dProt).plus(dTemp);
    }
    function kilosALitros(k, g, p, t){
      const d = calcularDensidade(g,p,t);
      if(d.lte(0)) return new Decimal(0);
      return new Decimal(k).div(d);
    }

    const $=(id)=>document.getElementById(id);
    const el={
      g:$('grasa'),p:$('proteina'),t:$('temp'),k:$('kilos'),
      eg:$('e-grasa'),ep:$('e-proteina'),et:$('e-temp'),ek:$('e-kilos'),
      od:$('out-densidade'), ol:$('out-litros'), os:$('out-estado')
    };

    el.g.addEventListener('input',filterDecimal2);
    el.p.addEventListener('input',filterDecimal2);
    el.t.addEventListener('input',filterDecimal1);
    el.k.addEventListener('input',filterInteger);

    [el.g,el.p,el.t,el.k].forEach(i=>i.addEventListener('input',recalc));

    function valGraxa(){
      const v=el.g.value.trim(); if(!v){limpa(el.g,el.eg); return null;}
      if(!rxGraxaProt.test(v)){erro(el.g,el.eg,'Formato: 0‚Äì10,00 con 2 decimais');return false;}
      const n=Number(normaliza(v)); if(n<0||n>10){erro(el.g,el.eg,'Rango: 0 a 10,00');return false;}
      limpa(el.g,el.eg); return n;
    }
    function valProte(){
      const v=el.p.value.trim(); if(!v){limpa(el.p,el.ep); return null;}
      if(!rxGraxaProt.test(v)){erro(el.p,el.ep,'Formato: 0‚Äì10,00 con 2 decimais');return false;}
      const n=Number(normaliza(v)); if(n<0||n>10){erro(el.p,el.ep,'Rango: 0 a 10,00');return false;}
      limpa(el.p,el.ep); return n;
    }
    function valTemp(){
      const v=el.t.value.trim(); if(!v){limpa(el.t,el.et); return null;}
      if(!rxTemp.test(v)){erro(el.t,el.et,'Formato: 0‚Äì50,0 cun decimal');return false;}
      const n=Number(normaliza(v)); if(n<0||n>50){erro(el.t,el.et,'Rango: 0 a 50,0');return false;}
      limpa(el.t,el.et); return n;
    }
    function valKilos(){
      const v=el.k.value.trim(); if(!v){limpa(el.k,el.ek); return null;}
      if(!rxKilos.test(v)){erro(el.k,el.ek,'Enteiro 0‚Äì100000');return false;}
      const n=Number(v); if(n<0||n>100000){erro(el.k,el.ek,'Rango: 0 a 100000');return false;}
      limpa(el.k,el.ek); return n;
    }

    function erro(inp,box,msg){inp.classList.add('is-bad');box.textContent=msg;box.classList.add('show');}
    function limpa(inp,box){inp.classList.remove('is-bad');box.textContent='';box.classList.remove('show');}

    function recalc(){
      const g=valGraxa(), p=valProte(), t=valTemp(), k=valKilos();
      if(g===null||p===null||t===null||k===null){out(null,null,'Introduce valores‚Ä¶',true);return;}
      if(g===false||p===false||t===false||k===false){out(null,null,'Revisa os campos en vermello',false,true);return;}
      const d=calcularDensidade(g,p,t); const l=kilosALitros(k,g,p,t);
      out(d,l,'C√°lculo correcto ‚úÖ',false);
    }
    function fmt(num,dec=3){if(num===null)return '‚Äî';return new Decimal(num).toFixed(dec);}
    function out(d,l,st,muted=false,err=false){
      el.od.textContent=d?fmt(d,3):'‚Äî'; el.ol.textContent=l?fmt(l,2):'‚Äî';
      el.od.className=muted?'muted':''; el.ol.className=muted?'muted':'ok';
      el.os.textContent=st; el.os.className=err?'':(muted?'muted':'ok');
    }
    recalc();
  </script>
</body>
</html>
